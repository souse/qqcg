define("consumer/addfastpayForm/1.0.0/addfastpayForm",["jquery/jquery/1.10.2/jquery","pafweblib/FormValidator/0.2.0/idcard","pafweblib/temporary/1.0.0/bankinput","$","pafweblib/temporary/1.0.0/numeral","pafweblib/FormValidator/0.2.1/FormValidator","consumer/sendotp/1.0.0/sendotp"],function(a,b){function c(){p.bankInput()}function d(){var a=new n("#addFastPayForm",{rules:{accountName:"required",certificateNo:"required|check18IdCard|checkAge10",bankNo:"required|minlength:12",bankMobile:"required|phone",securityCode:"required|threeNum","otp.otpValue":"hasSendCheck|required"},messages:{accountName:{required:"请输入您的真实姓名"},certificateNo:{required:"请输入您的身份证号",check18IdCard:"请输入正确的18位身份证号",checkAge10:"用户必须是10岁以上"},bankNo:{required:"请输入银行卡号",minlength:"银行卡号至少为12位数字"},bankMobile:{required:"请输入银行卡预留手机号",phone:"请输入正确的手机号码"},securityCode:{required:"请输入卡背面末三位数字",threeNum:"请输入正确的三位数字"},"otp.otpValue":{required:"请输入获取的验证码",hasSendCheck:"请点击获取验证码"}},success:{bankNo:function(b){var c=l(b),d=l.trim(c.val()),e=l.trim(l("#supportCardType").val());l.ajax({type:"POST",url:"/instruments/canFastPay",data:{bankNo:d,supportCardType:e},dataType:"json",success:function(b){var d=b.data;"000000"==b.code?(a.clearError(c),f(d.cardFullName),h("C"==d.bankType),i(d)):(a.errors[c.data("id")]=b.message,a.renderError(c),g(),i({bankShort:"",bankType:""}))},error:function(){}})},bankMobile:function(a){var b=l(a),c=l.trim(b.val());s.data("sendOTPCount")||s.prop("disabled",!1),e(c)}},fail:{bankNo:function(){g()},bankMobile:function(){s.prop("disabled",!0)}}});a.extendRules({threeNum:function(a,b){return/^\d{3}$/.test(b)},hasSendCheck:function(){var a=r,b=l.trim(a.val());return b.length>8},check18IdCard:function(a,b){var c=l("#"+a),d=l.trim(b);return c.is(":hidden")?!0:m.check18IdCard(d)},checkAge10:function(a,b){var c=l("#"+a),d=l.trim(b);return c.is(":hidden")?!0:m.checkAge(d,10)}}),a.launched()}function e(a){j?k.changeSendData({mobile:a}):a&&(k=o.create({$otpBtn:s,$otpValue:l("#otpValue"),sendData:{mobile:a}})),j=a}function f(a){var b=p,c=b.closest(".control"),d=c.find(".help-inline:not(.help-inline-supportcard)");0==d.length&&(d=l("<span/>",{"class":"help-inline"})),c.append(d),d.html(a),c.addClass("hide-txt")}function g(){var a=p,b=a.closest(".control"),c=b.find(".help-inline:not(.help-inline-supportcard)");0!=c.length&&c.remove(),b.removeClass("hide-txt")}function h(a){q.closest(".box-form")[a?"addClass":"removeClass"]("kind-credit"),q.find("div.control-group-cvv2 input, div.control-group-period select").attr("disabled",!a)}function i(a){l("#bankShort").val(a.bankShort),l("#bankType").val(a.bankType),l("#protocolLabel")[0].className=a.bankShort}var j,k,l=a("jquery/jquery/1.10.2/jquery"),m=a("pafweblib/FormValidator/0.2.0/idcard"),n=(a("pafweblib/temporary/1.0.0/bankinput"),a("pafweblib/temporary/1.0.0/numeral"),a("pafweblib/FormValidator/0.2.1/FormValidator")),o=a("consumer/sendotp/1.0.0/sendotp"),p=l("#bankNo"),q=l("#addFastPayForm"),r=q.find('[name="otp.id"]'),s=l("#otpSend");b.init=function(){c(),d(),e(l.trim(l("#bankMobile").val()))}});
