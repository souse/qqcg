define("consumer/safecenter-identity/1.0.0/index",["bankinput","sendotp","idcard","paf"],function(a,b){function c(){seajs.use(["pwdgrd"],function(a){var b=[],c={id:"payPassword",sClass:"PWDsClass pafweblib-pwdGrd",iClass:"PWDiClass pafweblib-pwdGrd-customized"};b.push(c);var d=function(a){if(a){for(var b=0;b<a.length;b++){var c=a[b];if(0==c.pwdLength())return $("#"+c.id).focus(),$("#PWDerrorMessage").html('<span style="color:red;">请填写您的登录密码</span>'),!1;$("#PWDerrorMessage").html(""),$("input").not($("#paymentPwd input")).not($("#oldOTP\\.otpValue")).not($("#newOTP\\.otpValue")).blur()}return!0}};j=new a({formSelector:"#identityForm",ctrls:b,preSubmitFunc:d,isMandatory:!0,rootPath:window.contextPath})})}function d(){a("bankinput"),$("#bankNo").bankInput()}function e(){a("sendotp"),seajs.use("sendotp",function(a){q=a,$("#otpSend").length>0?q.create({$otpBtn:$("#otpSend"),$otpValue:$("#oldOTP\\.otpValue"),sendData:{mobile:$("#BankMobileInput").val()}}):n=!0,$("#otpSendT").click(function(){var a=/^(1[^012][0-9]{9})$/i,b=$.trim($("#newMobile").val());return a.test($.trim(b))?void 0:($("#newMobile").blur(),void 0)})})}function f(){var b=a("idcard");if($("input[name=identityNumber]").length>0){var c=$("input[name=identityNumber]"),d=c.siblings(),e=$.trim(c.val());if(!b.check18IdCard(e))return d.html(r.identityNumber),m=!1;d.html("")}for(var f=0;f<s.length;f++){var g=s[f],h=$("#"+g.id),i=$("#"+g.id+"error");if(h.length>0){if("n"==i.attr("value"))return i.css("color","red"),m=!1;i.css("color","#3fa7d2")}}if($("#bankNo").length>0){var j=$("#bankNo"),k=$.trim(j.val()),l=j.siblings(".help-block");if(k.length<12||/\D/g.test(k))return l.html('<span style="color:red;">'+r.bankNo+"</span>"),m=!1;var n=k+$("#bankSelectList").html();n=n.replace(/\D/g,""),$("#bankCard").val(n),l.html("")}return m=!0}function g(){$("#btnShowImg").mousemove(function(){$("#uploadDemoImg").show()}).mouseout(function(){$("#uploadDemoImg").hide()}),$("input").not($("#paymentPwd input")).not($("#oldOTP\\.otpValue")).not($("#newOTP\\.otpValue")).blur(function(){f()}),$("#oldOTP\\.otpValue").blur(function(){var a={otpId:$("#oldOTP\\.id").val(),otpValue:$("#oldOTP\\.otpValue").val(),mobile:$("#BankMobileInput").val(),flag:"old"};6==$("#oldOTP\\.otpValue").val().length&&$.ajax({url:window.contextPath+"/safecenter/validOTP",type:"get",data:a,dataType:"json",success:function(a){a.otpFlag?(n=!0,$("#oldOTP\\.otpValue").attr("disabled","disabled").siblings(".help-block").css("color","#3fa7d2").html("短信验证成功"),$("#otpSend").hide()):(n=!1,$("#oldOTP\\.otpValue").siblings(".help-block").html("短信验证码错误"))},error:function(){n=!1,$("#oldOTP\\.otpValue").siblings(".help-block").html("验证失败")}})}),$("#newOTP\\.otpValue").blur(function(){var a={otpId:$("#newOTP\\.id").val(),otpValue:$("#newOTP\\.otpValue").val(),mobile:$("#newMobile").val(),flag:"new"};6==$("#newOTP\\.otpValue").val().length&&$.ajax({url:window.contextPath+"/safecenter/validOTP",type:"get",data:a,dataType:"json",success:function(a){a.otpFlag?(o=!0,$("#newMobile").attr("disabled","disabled"),$("#newMobilenums").val($("#newMobile").val()),$("#newOTP\\.otpValue").attr("disabled","disabled").siblings(".help-block").css("color","#3fa7d2").html("短信验证成功"),$("#otpSendT").hide()):(o=!1,$("#newOTP\\.otpValue").siblings(".help-block").html("短信验证码错误"))},error:function(){o=!1,$("#newOTP\\.otpValue").siblings(".help-block").html("验证失败")}})}),$("#newMobile").blur(function(){var a=/^(1[^012][0-9]{9})$/i,b=$("#newMobile"),c=b.val(),d=b.siblings(".help-block");return a.test($.trim(c))?($.ajax({url:window.contextPath+"/safecenter/validMobile",type:"post",data:{newMobile:c},dataType:"json",success:function(a){if(void 0===a.code)return!1;if("000000"!=a.code){p=!1;var b=a.message||"";d.html(b)}else{var c=$.trim($("#newMobile").val());q.create({$otpBtn:$("#otpSendT"),$otpValue:$("#newOTP\\.otpValue"),sendData:{mobile:c}}),p=!0,d.html("")}},error:function(){p=!1,d.html(r.phone)}}),void 0):(p=!1,d.html(r.phone),void 0)}),$("button.paf-btn-primary").click(function(){if(k){var b=j.getPgeditorById("payPassword");if(b.pwdResult(),b.getDevID(),b.getPcInfo(),0===b.pwdLength())return $("#PWDerrorMessage").html(r.passwordErr),l=!1;if($("#PWDerrorMessage").html(""),l=!0,l&&m&&p&&n&&o){var c=a("paf"),d=$("#newMobile").val();c.dialog("更改提示",'<p>如果修改成功，新的手机号 <span style="color:#0087e3"> ('+d+') </span>将做为您的壹钱包<br>登录账号，原手机号无法继续登录。</p><div style="position:absolute;width:225px;height:130px;background:#d2d2d2;top:0;right:0;line-height:20px"><img src="/static/consumer/safecenter/safecenter-modules/src/login.png" style="width:225px;height:130px;"><span>请使用修改后的手机登录壹钱包</span></div>',function(){k=!1,$("#identityForm").submit()})}else m?l?n?o?p||$("#newMobile").siblings(".help-block").html(r.phone):(o=!1,$("#newOTP\\.otpValue").siblings(".help-block").html(r.otpValue)):(n=!1,$("#oldOTP\\.otpValue").siblings(".help-block").html(r.otpValue)):$("#PWDerrorMessage").html(r.passwordErr):f()}}),$("#reason").keyup(function(){var a=$("#reason");if(a.length>0){var b=a.val(),c=parseInt(b.replace(/[^\u4e00-\u9FA5]/g,"").length),d=c+b.length;b.length-c,d>200&&a.val(b.substr(0,b.length-1))}}),$("#reason").blur(function(){var a=$("#reason");if(a.length>0){var b=a.val(),c=parseInt(b.replace(/[^\u4e00-\u9FA5]/g,"").length),d=c+b.length;d>200&&a.val("非必填，100个汉字左右")}})}function h(){seajs.use("uploader",function(a){function b(b){new a({trigger:"#"+b.id,action:"/safecenter/changeMobile/uploadImageFile",fileName:"files",multiple:!0,data:b.data,accept:"image/jpeg,image/jpg,image/png,image/JPEG,image/JPG,image/PNG"}).success(function(a){"000000"==a.code?$("#"+b.id+"error").html(b.txt+"上传成功").attr("value","y").css("color","#3fa7d2"):$("#"+b.id+"error").html(a.message).attr("value","n").css("color","red")}).error(function(){$("#"+b.id+"error").html(b.txt+"上传失败，请重新上传").attr("value","n").css("color","red")})}for(var c=0;c<s.length;c++){var d=s[c],e=$("#"+d.id);e.length>0&&b(d)}})}function i(){g(),$("#pay_pwds").length>0?c():l=!0,$("#bank_cards").length>0&&d(),e(),h()}var j,k=!0,l=!1,m=!1,n=!1,o=!1,p=!1,q="",r={passwordErr:"请输入支付密码",identityNumber:"请输入正确的18位身份证号",bankNoInfo:"请补全绑定的快捷支付银行卡号（已给出最后4位）",bankNo:"银行卡号至少为12位数字，请输入银行卡号",phone:"请输入正确的手机号码",otpValue:"请输入正确的手机短信验证码"},s=[{id:"fileIDA",txt:"手持证件照",data:{attachType:10}},{id:"fileIDB",txt:"证件正面照",data:{attachType:11}},{id:"fileIDC",txt:"证件反面照",data:{attachType:12}},{id:"fileIDD",txt:"银行卡正面照",data:{attachType:13}}];b.init=function(){i()}});
