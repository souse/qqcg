define("pafweblib/uploader/0.1.0/Uploader",["$"],function(a,b,c){function d(a){"string"===j.type(a)&&(a={trigger:a}),a=n({},o,a);var b=j(a.trigger);this.options=n(a,{action:b.data("action"),fileName:b.data("filename"),multiple:b.data("multiple"),accept:b.data("accept")||void 0,data:b.data("data"),iframe:"true"==b.data("iframe")||void 0}),this.init()}function e(a){var b=j(a.trigger),c=j("<form enctype='multipart/form-data' method='post'></form>").attr({action:a.action}),e=a.data||{},f="callbak"+(new Date).getTime();return window.FormData&&(window[f]=d.prototype.uploadCallback,n(e,{"X-Requested-With":"IFRAME",callback:f})),c.append(g(e)).css({position:"absolute",top:b.offset().top,left:b.offset().left,overflow:"hidden",width:b.outerWidth(),height:b.outerHeight(),zIndex:i(b)+10}),c}function f(a){var b=j(k.createElement("input")),c=j(a.trigger),d={type:"file",name:a.fileName,hidefocus:!0};return a.accept&&(d.accept=a.accept),a.multiple&&(d.multiple=!0),b.attr(d),b.css({position:"absolute",top:0,right:0,opacity:0,outline:0,cursor:"pointer",height:c.outerHeight(),fontSize:Math.max(64,5*c.outerHeight())}),b}function g(a){if(!a)return[];var b,c=[];for(var d in a)b=k.createElement("input"),b.type="hidden",b.name=d,b.value=a[d],c.push(b);return c}function h(){var a="iframe-uploader-"+l,b=j('<iframe name="'+a+'" />').hide();return l+=1,b}function i(a){for(var b=a.parentsUntil("body"),c=0,d=0;d<b.length;d++){var e=b.eq(d);"static"!==e.css("position")&&(c=parseInt(e.css("zIndex"),10)||c)}return c}var j=a("$"),k=document,l=0,m=j.noop,n=j.extend,o={trigger:"#uploader",action:"/upload",fileName:"files",multiple:!1,accept:void 0,iframe:!1,data:null,change:m,error:m,success:m};d.prototype.init=function(){var a=this.options;return this.$form=e(a),this.$input=f(a),this.$form.append(this.$input).appendTo("body"),this.bindEvent(),this},d.prototype.bindEvent=function(){var a=this,b=a.options,c=j(b.trigger);c.mouseenter(function(){a.$form.css({top:c.offset().top,left:c.offset().left,width:c.outerWidth(),height:c.outerHeight()})}),a.bindInputEvent()},d.prototype.bindInputEvent=function(){var a=this,b=a.options;a.$input.change(function(c){a._files=this.files||[{name:c.target.value}];var d=a.$input.val();if(b.change!=m)b.change.call(a,a._files);else if(d)return a.submit()})},d.prototype.submit=function(){var a,b=this,c=b.options,d=b.$form;if(window.FormData&&b._files&&!c.iframe){var e=new FormData(d.get(0));return j.ajax({url:c.action,type:"post",processData:!1,contentType:!1,data:e,dataType:"json",context:b,success:c.success,error:c.error}),b}return a=h(),d.attr("target",a.attr("name")),j("body").append(a),a.one("load",function(){try{var a=this.contentWindow?this.contentWindow.document:this.contentDocument?this.contentDocument:this.document,e=a.documentElement?a.documentElement:a.body,f=e.getElementsByTagName("textarea")[0],g=j.parseJSON(f.value)}catch(h){}j('<iframe src="javascript:false;"></iframe>').appendTo(d).remove(),j(this).remove(),g?c.success&&c.success(g):c.error&&c.error(b._files)}),b.$iframe=a,d.submit(),this},d.prototype.change=function(a){return a?(this.options.change=a,this):this},d.prototype.success=function(a){return a?(this.options.success=a,this):this},d.prototype.error=function(a){return a?(this.options.error=a,this):this},d.prototype.enable=function(){this.$input.prop("disabled",!1),this.$input.css("cursor","pointer")},d.prototype.disable=function(){this.$input.prop("disabled",!0),this.$input.css("cursor","not-allowed")},c.exports=d});
