define("consumer/jqbao-index/1.0.1/jqbao-index",["./rpyForm","jquery/jquery/1.10.2/jquery","pafweblib/FormValidator/0.2.1/FormValidator","$","./billInfo","gallery/moment/2.0.0/moment","./billAccountSelectBody.handlebars","./billAccount.handlebars","./billDetailTableBody.handlebars","./banklist"],function(a,b){var c={rpyForm:a("./rpyForm"),billInfo:a("./billInfo"),banklist:a("./banklist")};b.init=function(){for(var a in c)try{c[a].init()}catch(b){window.console&&console.log("jqbao-index 子模块初始化有误："+a)}}}),define("consumer/jqbao-index/1.0.1/rpyForm",["jquery/jquery/1.10.2/jquery","pafweblib/FormValidator/0.2.1/FormValidator","$"],function(a,b){var c=a("jquery/jquery/1.10.2/jquery"),d=a("pafweblib/FormValidator/0.2.1/FormValidator"),e=window,f=c("#totalNotBillDueAmt"),g=c("#totalBillDueAmt"),h=e.parseFloat(f.text().replace(/,/g,""))+e.parseFloat(g.text().replace(/,/g,"")),i=function(){var a=new d("#jqbaoRpyForm",{rules:{repaymentAmount:"required|numeric|maxCheck|minCheck|numericTwoDecimalDigit"},messages:{repaymentAmount:{numeric:"请输入有效的还款金额",maxCheck:"还款金额不能超过欠款总额",minCheck:"还款金额不能低于0.01元",numericTwoDecimalDigit:"还款金额不能超过两位小数"}}});a.extendRules({numeric:function(a,b){var c=/^([0-9]+(\.[0-9]+)?)?$/;return c.test(b)},maxCheck:function(a,b){return e.parseFloat(b)>h?!1:!0},minCheck:function(a,b){return val=e.parseFloat(b),b>=0&&.01>b?!1:!0},numericTwoDecimalDigit:function(a,b){var c=/^([0-9]+(\.[0-9]{1,2})?)?$/;return c.test(b)}}),a.launched()};b.init=function(){i()}}),define("consumer/jqbao-index/1.0.1/billInfo",["jquery/jquery/1.10.2/jquery","gallery/moment/2.0.0/moment"],function(a,b){function c(){h.ajax({dataType:"json",type:"get",url:"/jqbao/billInfoQuery",cache:!1,data:{}}).done(function(b){if("000000"==b.code){f=b.data;var c,e,g,j=a("consumer/jqbao-index/1.0.1/billAccountSelectBody.handlebars");h.each(f,function(a,b){b.totalDueAmt=(b.duePrincipalAmt||0)+(b.dueInterestAmt||0)+(b.dueBofAmt||0)+(b.dueTrxFee||0)+(b.dueOverInt||0),b.totalDueAmt=Math.round(100*b.totalDueAmt)/100,b.rpyState=b.totalDueAmt>b.totalRpyAmt,b.restAmt=b.totalDueAmt-b.totalRpyAmt,b.restAmt=Math.round(100*b.restAmt)/100,c=i(b.billCycle+"24","YYYYMMDD"),b.month=c.format("YYYY.MM"),b.billCycleRegion=c.format("YYYY.MM.DD"),e=c.subtract("M",1).add("days",1),b.billCycleRegion=e.format("YYYY.MM.DD")+" - "+b.billCycleRegion,b.duePrincipalAmt=b.duePrincipalAmt?parseFloat(b.duePrincipalAmt).toFixed(2):"无",b.dueInterestAmt=b.dueInterestAmt?parseFloat(b.dueInterestAmt).toFixed(2):"无",b.dueBofAmt=b.dueBofAmt?parseFloat(b.dueBofAmt).toFixed(2):"无",b.dueTrxFee=b.dueTrxFee?parseFloat(b.dueTrxFee).toFixed(2):"无",b.dueOverInt=b.dueOverInt?parseFloat(b.dueOverInt).toFixed(2):"无",b.staticFileRoot=window.staticFileRoot}),g=j({billAccountList:f,hasNoneMore:f.length<6}),k.append(g),d()}else window.console&&console.error("提示用户错误信息："+b.message+", code:"+b.code)}).fail(function(){window.console&&console.error("/jqbao/billInfoQuery 进行响应未正确返回的处理")})}function d(){var b,c,d=k,g=d.find(".selectHeader"),i=d.find(".selectBody"),n=i.find("li"),o=m.eq(0),p=m.eq(1),q=[],r=a("consumer/jqbao-index/1.0.1/billAccount.handlebars"),s=0;g.on("click",function(){return i.toggle(),d.toggleClass("paf-select-open"),!1}),i.on("click","li",function(){var a=h(this),b=n.index(this),j=b-1;return a.hasClass("option-disabled")?!1:(g.find(".selectHeader-content").html(a.data("content")),i.hide(),d.removeClass("paf-select-open"),s==b?!1:(m.hide(),0==b?(l.hide(),o.show(300)):(l.text(f[j].billCycleRegion).show(),c=r(f[j]),p.empty().html(c).show(300)),s=b,0!=s&&e(a.data("billcycle")),!1))}),p.on("click","#jqbaoBillDetailTabItemsContainer li",function(a){var c=h(a.currentTarget).data("trxtype"),d=h(this).closest("li"),f=q,g=b;return d.hasClass("ui-tab-item-current")?!1:(0===f.length&&(f=d.closest("#jqbaoBillDetailTabItemsContainer"),g=f.find("li")),g.removeClass("ui-tab-item-current"),d.addClass("ui-tab-item-current"),e(h("#billDetailBillCycle").val(),c),!1)}),h(j).on("click",function(a){var b=h(a.target);b.closest(".paf-select").length||(i.hide(),d.removeClass("paf-select-open"))}),p.on("click","#ReturnToTotal",function(){return n.eq(0).click(),!1}),p.on("click","#refreshMonthBill",function(){return c=r(f[s-1]),p.empty().html(c).show(300),e(n.eq(s).data("billcycle")),!1})}function e(b,c){function d(){e=j({exception:!0}),k.empty().html(e)}var e,f,j=a("consumer/jqbao-index/1.0.1/billDetailTableBody.handlebars"),k=h("#billDetailTableBody");f=c?{billCycle:b,trxType:c}:{billCycle:b},h.ajax({dataType:"json",type:"get",url:"/jqbao/billDetailInfoQuery",data:f}).done(function(a){try{"000000"==a.code?(g=a.data,h.each(g,function(a,b){b.trxDateLong=i(b.trxDate,"YYYYMMDD HHmmss").format("YYYY.MM.DD HH:mm:ss"),b.trxRefNoHref="/deal/showSingleDetail?transId="+b.trxRefNo,b.trxAmt=b.trxAmt?parseFloat(b.trxAmt).toFixed(2):""}),e=j({billDetailList:g,billCycle:b}),k.empty().html(e)):(d(),window.console&&console.error("billDetailInfoQuery接口返回："+a.message+", code:"+a.code))}catch(c){d(),window.console&&console.error("billDetailInfoQuery接口返回错误数据格式")}}).fail(function(){d(),window.console&&console.error("billDetailInfoQuery接口异常")})}var f,g,h=a("jquery/jquery/1.10.2/jquery"),i=a("gallery/moment/2.0.0/moment"),j=document,k=h("#jqbaoMonthSelect"),l=h("#jqbaoMonthRegion"),m=h("#jqbaoMonthAccountContainer .paf-box-content");b.init=c}),define("consumer/jqbao-index/1.0.1/billAccountSelectBody.handlebars",["gallery/handlebars/1.0.2/runtime"],function(a,b,c){var d=a("gallery/handlebars/1.0.2/runtime"),e=d.template;c.exports=e(function(a,b,c,d,e){function f(a,b){var d,e="";return e+='\n    <li data-content="',(d=c.month)?d=d.call(a,{hash:{},data:b}):(d=a.month,d=typeof d===l?d.apply(a):d),e+=m(d)+'" data-billcycle="',(d=c.billCycle)?d=d.call(a,{hash:{},data:b}):(d=a.billCycle,d=typeof d===l?d.apply(a):d),e+=m(d)+'" class="option ',d=c["if"].call(a,a.rpyState,{hash:{},inverse:n.noop,fn:n.program(2,g,b),data:b}),(d||0===d)&&(e+=d),e+='">\n        <span>',(d=c.month)?d=d.call(a,{hash:{},data:b}):(d=a.month,d=typeof d===l?d.apply(a):d),e+=m(d)+"</span>\n    </li>\n    "}function g(){return"option-owe"}function h(){return'\n    <li data-content="无更多" class="option option-disabled">\n        <span>无更多</span>\n    </li>\n    '}this.compilerInfo=[3,">= 1.0.0-rc.4"],c=c||{};for(var i in a.helpers)c[i]=c[i]||a.helpers[i];e=e||{};var j,k="",l="function",m=this.escapeExpression,n=this;return k+='<ul class="selectBody">\n    <li data-content="总账单" class="option">\n        <span>总账单</span>\n    </li>\n    ',j=c.each.call(b,b.billAccountList,{hash:{},inverse:n.noop,fn:n.program(1,f,e),data:e}),(j||0===j)&&(k+=j),k+="\n    ",j=c["if"].call(b,b.hasNoneMore,{hash:{},inverse:n.noop,fn:n.program(4,h,e),data:e}),(j||0===j)&&(k+=j),k+="\n</ul>"})}),define("consumer/jqbao-index/1.0.1/billAccount.handlebars",["gallery/handlebars/1.0.2/runtime"],function(a,b,c){var d=a("gallery/handlebars/1.0.2/runtime"),e=d.template;c.exports=e(function(a,b,c,d,e){function f(a,b){var d,e="";return e+='\n<div class="jqbao-formula">\n<a href="#" id="ReturnToTotal" class="fn-link">去还款</a>\n<span>本月已出账单金额</span>\n<span class="formula"><span class="var" title="总欠款">',(d=c.totalDueAmt)?d=d.call(a,{hash:{},data:b}):(d=a.totalDueAmt,d=typeof d===k?d.apply(a):d),e+=l(d)+'</span>-<span class="var" title="已还欠款">',(d=c.totalRpyAmt)?d=d.call(a,{hash:{},data:b}):(d=a.totalRpyAmt,d=typeof d===k?d.apply(a):d),e+=l(d)+'</span>=<var class="em">',(d=c.restAmt)?d=d.call(a,{hash:{},data:b}):(d=a.restAmt,d=typeof d===k?d.apply(a):d),e+=l(d)+"</var><em>元</em></span>\n</div>\n"}function g(){return'\n<div class="jqbao-state">\n<span class="icon-settingstate-on"></span><var>已还款</var>\n</div>\n'}this.compilerInfo=[3,">= 1.0.0-rc.4"],c=c||{};for(var h in a.helpers)c[h]=c[h]||a.helpers[h];e=e||{};var i,j="",k="function",l=this.escapeExpression,m=this;return j+='\n<table class="paf-table paf-table-bordered paf-table-fixed paf-table-break jqbao-billaccounttable">\n    <thead>\n    <tr>\n        <th class="c1">本金（元）</th>\n        <th class="c2">利息（元）</th>\n        <th class="c3">违约金（元）</th>\n        <th class="c4">逾期利息（元）</th>\n        <th class="c5">服务费（元）</th>\n    </tr>\n    </thead>\n    <tbody>\n    <tr>\n        <td><span>',(i=c.duePrincipalAmt)?i=i.call(b,{hash:{},data:e}):(i=b.duePrincipalAmt,i=typeof i===k?i.apply(b):i),j+=l(i)+"</span></td>\n        <td><span>",(i=c.dueInterestAmt)?i=i.call(b,{hash:{},data:e}):(i=b.dueInterestAmt,i=typeof i===k?i.apply(b):i),j+=l(i)+"</span></td>\n        <td><span>",(i=c.dueBofAmt)?i=i.call(b,{hash:{},data:e}):(i=b.dueBofAmt,i=typeof i===k?i.apply(b):i),j+=l(i)+"</span></td>\n        <td><span>",(i=c.dueOverInt)?i=i.call(b,{hash:{},data:e}):(i=b.dueOverInt,i=typeof i===k?i.apply(b):i),j+=l(i)+"</span></td>\n        <td><span>",(i=c.dueTrxFee)?i=i.call(b,{hash:{},data:e}):(i=b.dueTrxFee,i=typeof i===k?i.apply(b):i),j+=l(i)+"</span></td>\n    </tr>\n    </tbody>\n</table>\n\n"+"\n",i=c["if"].call(b,b.rpyState,{hash:{},inverse:m.program(3,g,e),fn:m.program(1,f,e),data:e}),(i||0===i)&&(j+=i),j+='\n\n\n<div id="jqbaoBillDetailTab" class="jqbao-billdetailtab">\n    <div class="ui-tab fn-clear">\n        <ul id="jqbaoBillDetailTabItemsContainer" class="ui-tab-items">\n            <li class="ui-tab-item ui-tab-item-current" data-trxType="">\n                <a href="javascript:;" class="active">全部明细</a>\n            </li>\n            <li class="ui-tab-item" data-trxType="CS">\n                <a href="javascript:;">消费</a>\n            </li>\n            <li class="ui-tab-item" data-trxType="R1:R2">\n                <a href="javascript:;">还款</a>\n            </li>\n            <li class="ui-tab-item" data-trxType="RF:WA:WR">\n                <a href="javascript:;">其它</a>\n            </li>\n        </ul>\n    </div>\n    <ul class="panels">\n        <table class="paf-table paf-table-striped paf-table-hover paf-table-condensed paf-table-fixed jqbao-billdetailtable">\n            <thead>\n            <tr>\n                <th>日期</th>\n                <th>金额（元）</th>\n                <th>订单名称</th>\n            </tr>\n            </thead>\n            <tbody id="billDetailTableBody">\n            <tr>\n                <td colspan="3">\n                    <div class="loading">\n                        <img src="',(i=c.staticFileRoot)?i=i.call(b,{hash:{},data:e}):(i=b.staticFileRoot,i=typeof i===k?i.apply(b):i),j+=l(i)+'/img/loading.gif" alt="加载中..."/>\n                    </div>\n                </td>\n            </tr>\n            </tbody>\n        </table>\n    </ul>\n</div>\n'})}),define("consumer/jqbao-index/1.0.1/billDetailTableBody.handlebars",["gallery/handlebars/1.0.2/runtime"],function(a,b,c){var d=a("gallery/handlebars/1.0.2/runtime"),e=d.template;c.exports=e(function(a,b,c,d,e){function f(a,b){var d,e="";return e+='\n    <tr>\n        <td class="date">',(d=c.trxDateLong)?d=d.call(a,{hash:{},data:b}):(d=a.trxDateLong,d=typeof d===m?d.apply(a):d),e+=n(d)+'</td>\n        <td class="money">',(d=c.trxAmt)?d=d.call(a,{hash:{},data:b}):(d=a.trxAmt,d=typeof d===m?d.apply(a):d),e+=n(d)+'</td>\n        <td class="object">',(d=c.trxTypeDes)?d=d.call(a,{hash:{},data:b}):(d=a.trxTypeDes,d=typeof d===m?d.apply(a):d),e+=n(d)+"</td>\n    </tr>\n"}function g(){return'\n    <tr>\n        <td colspan="3" class="info">没有相关账单</td>\n    </tr>\n'}function h(){return'\n    <tr>\n        <td colspan="3" class="info">很抱歉，系统异常，请稍后<a id="refreshMonthBill" href="#">点此刷新</a>！</td>\n    </tr>\n'}this.compilerInfo=[3,">= 1.0.0-rc.4"],c=c||{};for(var i in a.helpers)c[i]=c[i]||a.helpers[i];e=e||{};var j,k,l="",m="function",n=this.escapeExpression,o=this,p=c.blockHelperMissing;return k={hash:{},inverse:o.program(3,g,e),fn:o.program(1,f,e),data:e},(j=c.billDetailList)?j=j.call(b,k):(j=b.billDetailList,j=typeof j===m?j.apply(b):j),c.billDetailList||(j=p.call(b,j,k)),(j||0===j)&&(l+=j),l+="\n",j=c["if"].call(b,b.exception,{hash:{},inverse:o.noop,fn:o.program(5,h,e),data:e}),(j||0===j)&&(l+=j),l+='\n<input type="hidden" id="billDetailBillCycle" value="',(j=c.billCycle)?j=j.call(b,{hash:{},data:e}):(j=b.billCycle,j=typeof j===m?j.apply(b):j),l+=n(j)+'">\n'})}),define("consumer/jqbao-index/1.0.1/banklist",[],function(a,b){function c(a){function b(){$("#"+a.btnId).click(function(){c()})}function c(){if($("#Id_dialogBox")[0])return $("#Id_dialogBox").show(),void 0;var a=$("#LTtoChangeMyBankCard").val()?$("#LTtoChangeMyBankCard").val():"",b='<div class="banklistBox" id="Id_dialogBox"><div class="banklistBoxBlock"></div><div class="banklistBody"><div class="banklistHeader"><span>储蓄卡</span><span class="banklistClose" id="banklistClose">╳</span></div><div class="banklistInfo">请选择自动还款银行卡</div><div class="banklistShowBox" id="Id_banklistBox"><ul class="banks">',c="",d='<li class="bank" style="text-align: center;"><a href="/instruments/addFastPay?returnURL=/jqbao&supportCardType=D"><span class="box-icon">+&nbsp;添加银行卡</span></a><li><input type="hidden" name="jqbaoToken" value="'+a+'"></form></ul></div><div id="LTtosubmitform" class="banklistSureBtn">确认</div></div></div>';$.ajax({dataType:"json",type:"GET",url:"/fastpaycard?time="+(new Date).getTime()}).done(function(a){if("000000"==a.code){var e=a.data;if(e.length>0){for(var f=0;f<e.length;f++){var g=e[f],h=g.bankEnc,i=h.substring(h.length-4,h.length);c+=0==f?'<form action="/jqbao/changeRpBankCard" method="post" name="bankform"><input type="hidden" name="bankCard" value="'+h+'" id="jqb_bankencform"/><li class="bank active"><label><input name="bankCode" type="radio" checked="checked"><span class="box-icon"><span class="spanBankName" title="'+g.bankName+'" bankenc="'+h+'" bankencshort="'+i+'">'+g.bankName+'</span><span class="spanBankNo">尾号'+i+"</span></span></label></li>":'<li class="bank"><label><input name="bankCode" type="radio"><span class="box-icon"><span class="spanBankName" title="'+g.bankName+'" bankenc="'+h+'" bankencshort="'+i+'">'+g.bankName+'</span><span class="spanBankNo">尾号'+i+"</span></span></label></li>"}$("body").append(b+c+d)}}}).fail(function(){}),$(document).on("click","#banklistClose",function(){$("#Id_dialogBox").hide()}),$(document).on("click","#LTtosubmitform",function(){$("#Id_banklistBox input[name=jqbaoToken]").val()!=$("#jqb_bankencform").val()?document.bankform.submit():$("#Id_dialogBox").hide()}),$(document).on("click","#Id_banklistBox li.bank",function(a){var b=$(a.currentTarget),c=b.find("span.spanBankName").attr("bankenc");$("#jqb_bankencform").val(c),b.addClass("active").find("input").prop("checked",!0),$("#Id_banklistBox li.bank").not(b).removeClass("active")})}if("undefined"!=a)try{b()}catch(d){}}b.init=function(){try{var a={btnId:"LTtoChangeMyBankCard",backBankName:"LTtoShowBankName",backBankNumF:"LTtoShowBankNum"};c(a)}catch(b){}}});
