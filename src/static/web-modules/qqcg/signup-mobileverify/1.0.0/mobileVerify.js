define("consumer/signup-mobileverify/1.0.0/mobileVerify",["$","FormValidator","sendotp"],function(a,b){function c(){var a=new j(l,{rules:{mobile:"required|phone","captcha.captchaValue":"required|minlength:4","otp.otpValue":"required"},messages:{mobile:{required:"请输入正确的手机号码",phone:"请输入正确的手机号码"},"captcha.captchaValue":{required:"请输入正确的图片验证码",minlength:"请输入正确的图片验证码"},"otp.otpValue":{required:"请输入获取的手机校验码",hasSendCheck:"请点击获取手机校验码"}},success:{mobile:function(a){var b=i(a),c=i.trim(b.val());m=!0,!q.data("sendOTPCount")&&m&&n&&q.prop("disabled",!1),i("#mobileVerifyId").val(c),e({mobile:c,captchaId:r.val(),captchaValue:s.val()})},"captcha.captchaValue":function(b){var c=i(b);d(function(){n=!0,m&&n&&q.prop("disabled",!1),e({mobile:o.val(),captchaId:r.val(),captchaValue:c.val()})},function(b){a.errors[c.data("id")]=b.message,a.renderError(c),n=!1,q.prop("disabled",!0)})}},fail:{mobile:function(){m=!1,q.prop("disabled",!0)},"captcha.captchaValue":function(){n=!1,q.prop("disabled",!0)}}});a.extendRules({hasSendCheck:function(){var a=p,b=i.trim(a.val());return b.length>8}}),a.launched()}function d(a,b){var c=i("#captcha\\.id").val(),d={id:c,captchaValue:i("#captcha\\.captchaValue").val()};i.ajax({dataType:"json",url:"/captcha/"+c+"/valid",data:d,success:function(c){c?"function"==typeof a&&a():"function"==typeof b&&b({message:"请正确输入验证码"})},fail:function(){"function"==typeof b&&b({message:"系统异常，验证码验证失效，请稍后刷新页面重试"})}})}function e(a){h?h.changeSendData(a):h=k.create({$otpBtn:q,$otpValue:i("#otp\\.otpValue"),sendData:a})}function f(){o.focus(),s.val()&&s.blur()}function g(){var a=!0;i("#refresh_captcha").click(function(){var b=this;return a&&(a=!1,setTimeout(function(){i.ajax({url:"/captcha",dataType:"json",method:"POST"}).done(function(a){var c=i(b),d=i("#"+c.data("id").replace(/[.]/g,"\\.")),e=i("#"+c.data("captchaimg"));e.prop("src",a.img),d.prop("value",a.id)}).always(function(){a=!0})},300)),!1})}var h,i=a("$"),j=a("FormValidator"),k=a("sendotp"),l=i("#mobileVerifyForm"),m=!1,n=!1,o=i("#mobile"),p=i("#otp\\.id"),q=i("#otpSend"),r=i("#captcha\\.id"),s=i("#captcha\\.captchaValue");b.init=function(){c(),e(i.trim(o.val())),g(),f()}});
