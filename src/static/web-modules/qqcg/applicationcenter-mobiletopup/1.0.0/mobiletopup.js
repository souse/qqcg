define("consumer/applicationcenter-mobiletopup/1.0.0/mobiletopup",["jquery/jquery/1.10.2/jquery","pafweblib/temporary/1.0.0/numeral","$","pafweblib/temporary/1.0.0/magnify","pafweblib/FormValidator/0.2.1/FormValidator"],function(a,b){var c,d,e,f=a("jquery/jquery/1.10.2/jquery"),g=(a("pafweblib/temporary/1.0.0/numeral"),a("pafweblib/temporary/1.0.0/magnify"),a("pafweblib/FormValidator/0.2.1/FormValidator"));b.init=function(){var a=f("#mobileNo");a.magnify({group:"344"}),a.numeral(),h.showDefaultAmt(),h.getUserData(),a.keyup(function(){h.timeoutData()}).blur(function(){h.getData()}),h.checkForm(),f("#radioGrp span.box").on("click",function(){var a=f(this),b=a.parent(),c=a.prev();c.prop("checked",!0),b.addClass("active"),b.siblings().removeClass("active"),h.getUserData()})};var h={showDefaultAmt:function(){f("#radioGrp input").each(function(){var a=f(this),b=a.parent(),c=(a.prev(),a.prop("checked"));c&&(b.addClass("active"),b.siblings().removeClass("active"))})},checkForm:function(){var a=new g("#mobileTopupForm",{rules:{mobileNo:"required|phone"},messages:{mobileNo:{required:"手机号码不能为空",phone:"请输入正确的11位手机号码"}}});a.launched()},timeoutData:function(){var a=this;c&&(clearTimeout(c),c=void 0),c=setTimeout(a.getUserData,300)},getData:function(){var a=this;clearTimeout(c),a.getUserData()},getUserData:function(){var a=/^(1[^012][0-9]{9})$/i,b=f("input:radio[name=amount]:checked"),c=f("#mobileNo"),g=c.val().replace(/\s*/g,""),h=b.val(),i=b.data("range");if(!(b.length<1)){if(!a.test(g))return c.next(".help-inline.result").fadeOut("fast"),f("#price-holder").html(i),void 0;if(d!=g||e!=h){d=g,e=h,f("#price-holder").fadeOut(50);var j=setTimeout(function(){f("#price-container").addClass("loading")},100);f.getJSON(window.contextPath+g+"/summary",{amt:h},function(a){var b=c.next(".help-inline.result");b.length||(b=f('<span class="help-inline result"></span>').insertAfter(c)),b.removeClass("failed").removeClass("success"),a.error?b.addClass("failed").html("暂不支持该手机号码充值"):(b.addClass("success").fadeIn("fast").html(a.area+a.provider),f("#price-holder").data("value",a.price))}).complete(function(){clearTimeout(j),f("#price-container").removeClass("loading"),f("#price-holder").html(f("#price-holder").data("value"))}).fail(function(){var a=c.next(".help-inline.result");a.length||(a=f('<span class="help-inline result"></span>').insertAfter(c)),a.removeClass("success").addClass("failed").fadeIn("fast").html("该面值产品正在维护中，请稍后再试")}).success(function(){f("#price-holder").fadeIn("fast")})}}}}});
