define("consumer/inetpaydialog/1.0.0/inetpaydialog",["consumer/dialog/1.0.0/dialog"],function(require,exports,modules){function extend(){for(var a,b=ArrayProto.slice.call(arguments,0),c={},d=0,e=b.length;e>d;d++)if(a=b[d])for(var f in a)c[f]=a[f];return c}function _getListData(a,b,c){var d=function(){return xmlhttp=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP")}(),e="";a=-1==a.indexOf("?")?a+"?"+e:a+e,d.open("GET",a,!0),d.send(),d.onreadystatechange=function(){4==d.readyState&&(d.status>=200&&d.status<300?"function"==typeof b&&b(d):"function"==typeof c&&c(d))}}function _concatBankListTmpl(a){for(var b,c='<div class="tab">                                <ul id="inetBanks" class="banks">{{liTmpl}}</ul>                            </div>',d="",e=0,f=a.length;f>e;e++)b=a[e],d+='<li class="'+(e>19?"hidden":"")+" bank "+(0==e?"active":"")+'">                                <label><input name="bankCode" data-paycardtype="'+b.dcCardType+'" data-bankcode="'+b.bankCode+'" data-bankName="'+b.bankName+'" type="radio" '+(0==e?"checked":"")+' value="'+b.bankId+'" />&nbsp;&nbsp;                                <span class="box-icon"><i class="icon-bank icon-bank-'+(b.bankCode.toLowerCase()||"pab")+'" >'+b.bankName+"</i></span></label>                            </li>",e==f-1&&f>20&&(d+='<li class="moreCards" id="moreInetBankCards"><a>更多银行卡∨</a></li>');return c.replace(/{{liTmpl}}/g,d)}function _removeClassHidden(){for(var a=doc.getElementById("inetBanks").childNodes,b=0;b<a.length;b++){var c=a[b];c.className.indexOf("hidden")>-1&&(c.className=c.className.replace(/hidden/g,""))}doc.getElementById("moreInetBankCards").className="hidden"}var doc=document,ArrayProto=Array.prototype,Dialog=require("consumer/dialog/1.0.0/dialog"),DialogProto=Dialog.prototype,InetPayDialog=function(a){var b=this.options=extend(InetPayDialogProto.defaultOptions,a);this.init(b)},readyState=!0,ERROR_TMPL='<div class="box-error">系统异常，请稍后再试</div>',InetPayDialogProto=InetPayDialog.prototype=extend(DialogProto,{create:function(a){return new InetPayDialog(a)},init:function(a){this.options.bankIconsSpriteUrl&&this.bankIconsSpritePreLoad(this.options.bankIconsSpriteUrl),DialogProto.init.call(this,a),this.createDialogContent(a)},exportData:{payCardType:"D",bankId:"444",bankCode:"PAB",bankName:"平安银行"},bankIconsSpritePreLoad:function(a,b){var c=new Image;c.src=a,c.complete?("undefined"!=typeof console&&console.log("img completed"),"undefined"!=typeof b&&b.call(c)):("undefined"!=typeof console&&console.log("img is loading"+new Date),c.onload=function(){"undefined"!=typeof console&&console.log("img is loaded"+new Date),"undefined"!=typeof b&&b.call(c),c.onload=null})},createDialogContent:function(options){var dialogInstance=this,dialog=this.dialog;_getListData(options.url,function(ajax){var loadingBox=doc.getElementById("loadingBox"),dialogHmtl='<h3><span class="title">选择银行：</span>需跳转银行页面，不享受平安保险保障</h3>',list=eval("("+ajax.responseText+")"),firstPayCard;try{firstPayCard=list[0],dialogInstance.exportData.bankId=firstPayCard.bankId,dialogInstance.exportData.payCardType=firstPayCard.dcCardType,dialogInstance.exportData.bankCode=firstPayCard.bankCode,dialogInstance.exportData.bankName=firstPayCard.bankName,dialogHmtl+=_concatBankListTmpl(list),dialogHmtl+='                            <div class="btns">                                <button id="inetBankDialogConfirmBtn" class="btn btn-primary btn-confirm">确定</button>                            </div>'}catch(e){readyState=!1,dialogHmtl=ERROR_TMPL}dialogInstance.displayDilogContent(dialogHmtl),dialogInstance.bandInetPayDialogEvents(),dialogInstance.showMoreBankCards()},function(){readyState=!1,dialogInstance.displayDilogContent(ERROR_TMPL)})},confirmHandler:function(){if(readyState){var a=this.options;"undefined"!=typeof a.confirmHandler&&a.confirmHandler.call(this)}},removeDialog:function(){DialogProto.removeDialog.call(this);try{for(var a=this.dialog,b=a.getElementsByTagName("input"),c=doc.getElementById("inetBankDialogConfirmBtn"),d=0,e=b.length;e>d;d++)b[d].onclick=null;c.onclick=null}catch(f){}},bandInetPayDialogEvents:function(){for(var a=this,b=this.dialog,c=b.getElementsByTagName("input"),d=c[0],e=doc.getElementById("inetBankDialogConfirmBtn"),f=0,g=c.length;g>f;f++)c[f].onclick=function(b){return function(){var e=c[b];a.exportData.bankId=e.value,a.exportData.payCardType=e.getAttribute("data-paycardtype"),a.exportData.bankCode=e.getAttribute("data-bankcode"),a.exportData.bankName=e.getAttribute("data-bankName"),d.parentNode.parentNode.className="bank",e.parentNode.parentNode.className="bank active",d=e}}(f);e.onclick=function(){a.confirmHandler(),a.removeDialog()}},displayDilogContent:function(a){var b=this.dialog,c=doc.getElementById("loadingBox"),d=doc.createElement("div");d.innerHTML=a,c.style.display="none",b.insertBefore(d,c)},showMoreBankCards:function(){var a=doc.getElementById("moreInetBankCards");a&&(a.onclick=function(){_removeClassHidden()})}});exports.create=InetPayDialogProto.create});
